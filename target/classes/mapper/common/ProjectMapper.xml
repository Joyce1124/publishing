<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.best.publishing.po.common.ProjectPo">
	<sql id="tablename">project</sql>

	<!-- Create Po -->
	<insert id="createPo">
	    <selectKey keyProperty="id" resultType="long">
            select LAST_INSERT_ID()
        </selectKey>
		insert into
		<include refid="tablename" />
		(
		<include refid="com.best.publishing.baseMapper.baseFieldCreate" />
			<!--18-->moveHeaderId,
		    <!--18-->moveDetailId,
            <!--19-->moveNo,
            <!--20-->skuId,
            <!--21-->skuCode,
            <!--22-->moveQtyUom,
            <!--23-->fromLocId,
            <!--24-->fromLocCode,
            <!--25-->toLocId,
            <!--26-->toLocCode,
            <!--27-->fromLpnhId,
            <!--28-->fromLpnCode,
            <!--29-->toLpnhId,
            <!--30-->toLpnCode
		)
		values (
		<include refid="com.best.wcs.baseMapper.baseInstructionLotFieldCreateValue" />
	       <!--18-->#{moveHeaderId,jdbcType=DECIMAL},
		   <!--18-->#{moveDetailId,jdbcType=DECIMAL},
           <!--19-->#{moveNo,jdbcType=VARCHAR},
           <!--20-->#{skuId,jdbcType=DECIMAL},
           <!--21-->#{skuCode,jdbcType=VARCHAR},
           <!--22-->#{moveQtyUom,jdbcType=FLOAT},
           <!--23-->#{fromLocId,jdbcType=DECIMAL},
           <!--24-->#{fromLocCode,jdbcType=VARCHAR},
           <!--25-->#{toLocId,jdbcType=DECIMAL},
           <!--26-->#{toLocCode,jdbcType=VARCHAR},
           <!--27-->#{fromLpnhId,jdbcType=DECIMAL},
           <!--28-->#{fromLpnCode,jdbcType=VARCHAR},
           <!--29-->#{toLpnhId,jdbcType=DECIMAL},
           <!--30-->#{toLpnCode,jdbcType=VARCHAR}
		)
	</insert>

	<!-- update Po -->
	<update id="update">
		update
		<include refid="tablename" />
		set
		<include refid="com.best.wcs.baseMapper.baseInstructionLotFieldUpdateValue" />
		  <!--18-->MOVEHEADERID = #{moveHeaderId,jdbcType=DECIMAL},
		  <!--18-->MOVEDETAILID = #{moveDetailId,jdbcType=DECIMAL},
	      <!--19-->MOVENO = #{moveNo,jdbcType=VARCHAR},
	      <!--20-->SKUID = #{skuId,jdbcType=DECIMAL},
	      <!--21-->SKUCODE = #{skuCode,jdbcType=VARCHAR},
	      <!--22-->MOVEQTYUOM = #{moveQtyUom,jdbcType=FLOAT},
	      <!--23-->FROMLOCID = #{fromLocId,jdbcType=DECIMAL},
	      <!--24-->FROMLOCCODE = #{fromLocCode,jdbcType=VARCHAR},
	      <!--25-->TOLOCID = #{toLocId,jdbcType=DECIMAL},
	      <!--26-->TOLOCCODE = #{toLocCode,jdbcType=VARCHAR},
	      <!--27-->FROMLPNHID = #{fromLpnhId,jdbcType=DECIMAL},
	      <!--28-->FROMLPNCODE = #{fromLpnCode,jdbcType=VARCHAR},
	      <!--29-->TOLPNHID = #{toLpnhId,jdbcType=DECIMAL},
	      <!--30-->TOLPNCODE = #{toLpnCode,jdbcType=VARCHAR}
		where id = #{id,jdbcType=DECIMAL} and version = #{version,jdbcType=DECIMAL}
	</update>
	
	<select id="search" resultMap="resultMap">
        select o.* from
        <include refid="tablename" />
        o
        <include refid="where" />
    </select>
    
	
	<select id="searchCount" resultType="java.lang.Long">
        select count(0) from
        <include refid="tablename" />
        o
        <include refid="where" />
    </select>
    
	<sql id="where">
	    <where>
            <if test="createdTimeFrom != null">
                and o.createdTime >= #{createdTimeFrom}
            </if>
            <if test="createdTimeTo != null">
                <![CDATA[ and o.createdTime <= #{createdTimeTo}]]>
            </if>
            <if test="!@com.best.wcs.utils.EasyUtil@isStringEmpty(status)">
                and o.status = #{status}
            </if>
            <if test="!@com.best.wcs.utils.EasyUtil@isStringEmpty(moveNo)">
                and o.moveNo = #{moveNo}
            </if>
            <if test = "whId != null">
                and o.whId = #{whId}
            </if>
        </where>
         order by o.createdTime desc
	</sql>
	
	<!-- delete -->
	<delete id="delete" parameterType="long">
		<include refid="com.best.wcs.baseMapper.baseDelete" />
	</delete>

	<!-- get Po by id -->
	<select id="getById" resultMap="resultMap" parameterType="long">
		<include refid="com.best.wcs.baseMapper.baseGetById" />
	</select>

	<!-- get Po by idList -->
	<select id="getByIdList" resultMap="resultMap">
		<include
			refid="com.best.wcs.baseMapper.baseGetByIdList" />
	</select>

    <select id="getNeedReSend" resultMap="resultMap">
        <include refid="com.best.wcs.baseMapper.baseGetNeedReSend"/>
    </select>

    <select id="getFailedSend" resultMap="resultMap">
        <include refid="com.best.wcs.baseMapper.baseGetFailedSend"/>
    </select>

    <select id="getMoveInstructionByMoveHeaderId" resultMap="resultMap">
        select * from <include refid="tablename" /> o where o.moveheaderId = #{moveHeaderId}
    </select>

	<!-- result map-->
	<resultMap id="resultMap" type="com.best.wcs.po.robot.WcsIoMoveOrder" extends="com.best.wcs.baseMapper.baseRobotLotResultMap">
	      <!--18--><result column="MOVEHEADERID" jdbcType="DECIMAL" property="moveHeaderId" />
		  <!--18--><result column="MOVEDETAILID" jdbcType="DECIMAL" property="moveDetailId" />
	      <!--19--><result column="MOVENO" jdbcType="VARCHAR" property="moveNo" />
	      <!--20--><result column="SKUID" jdbcType="DECIMAL" property="skuId" />
	      <!--21--><result column="SKUCODE" jdbcType="VARCHAR" property="skuCode" />
	      <!--22--><result column="MOVEQTYUOM" jdbcType="FLOAT" property="moveQtyUom" />
	      <!--23--><result column="FROMLOCID" jdbcType="DECIMAL" property="fromLocId" />
	      <!--24--><result column="FROMLOCCODE" jdbcType="VARCHAR" property="fromLocCode" />
	      <!--25--><result column="TOLOCID" jdbcType="DECIMAL" property="toLocId" />
	      <!--26--><result column="TOLOCCODE" jdbcType="VARCHAR" property="toLocCode" />
	      <!--27--><result column="FROMLPNHID" jdbcType="DECIMAL" property="fromLpnhId" />
	      <!--28--><result column="FROMLPNCODE" jdbcType="VARCHAR" property="fromLpnCode" />
	      <!--29--><result column="TOLPNHID" jdbcType="DECIMAL" property="toLpnhId" />
	      <!--30--><result column="TOLPNCODE" jdbcType="VARCHAR" property="toLpnCode" />
	</resultMap>
</mapper>
